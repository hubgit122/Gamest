!function(a){"use strict";function b(b,c,d){return d===!0&&(this.getAttribute("multiple")||a.selectBox.updateMaskValue(this.parentNode.id,this.text,this.value),this.parentNode.value=this.value),d}function c(b,c,d){return this.options[d]&&(this.getAttribute("multiple")||a.selectBox.updateMaskValue(this.linker,this.options[d].value,this.options[d].text),this.value=this.options[d].value),d}function d(b){var c=b.target;a(c.linker).remove(),delete c.linker,b.stopPropagation()}a.selectBox={scroller:null,currLinker:null,getOldSelects:function(e){if(a.os.android&&!a.os.androidICS){if(!a.fn.scroller)return window.alert("This library requires af.scroller"),void 0;var f=e&&document.getElementById(e)?document.getElementById(e):document;if(!f)return window.alert("Could not find container element for af.selectBox "+e),void 0;for(var g=f.getElementsByTagName("select"),h=this,i=0;i<g.length;i++){var j=g[i];j.style.display="none";var k=a.create("div",{className:"afFakeSelect"});k.get(0).linker=g[i],j.linker=k.get(0),k.insertAfter(g[i]),j.watch("selectedIndex",c);for(var l=0;l<j.options.length;l++)j.options[l].watch("selected",b),j.options[l].selected&&k.html(j.options[l].text);a(j).one("destroy",d)}h.createHtml()}},updateDropdown:function(a){if(a){for(var b=0;b<a.options.length;b++)a.options[b].selected&&(a.linker.innerHTML=a.options[b].text);a=null}},initDropDown:function(c){if(!c.disabled&&c&&c.options&&0!==c.options.length){var f=0,g=a("#afSelectBoxfix");g.html("<ul></ul>");for(var h=g.find("ul"),i=0;i<c.options.length;i++){c.options[i].watch("selected",b);var k=c.options[i].selected?"selected":"";k&&(f=i+1);var l=a.create("li",{html:c.options[i].text,className:k});l.data("ind",i),h.append(l)}a("#afModalMask").show();try{if(f>0&&"multiple"!==c.getAttribute("multiple")){var m=0,n=numOnly(h.find("li").computedStyle("height")),o=numOnly(a("#afSelectBoxContainer").computedStyle("height"));f*n>=o&&(m=(f-1)*-n),this.scroller.scrollTo({x:0,y:m})}}catch(p){console.log("error init dropdown"+p)}var q="block"===a("#afSelectClose").css("display")?numOnly(a("#afSelectClose").height()):0;a("#afSelectWrapper").height(numOnly(a("#afSelectBoxContainer").height())-q+"px")}},updateMaskValue:function(b,c,d){a(b).html(d)},setDropDownValue:function(b,c){if(b){var d=a(b);if(c=parseInt(c,10),b.getAttribute("multiple")){var e=a("#afSelectBoxfix li:nth-child("+(c+1)+")");e.hasClass("selected")?e.removeClass("selected"):e.addClass("selected")}else b.selectedIndex=c,d.find("option").prop("selected",!1),d.find("option:nth-child("+(c+1)+")").prop("selected",!0),this.scroller.scrollTo({x:0,y:0}),this.hideDropDown();a(b).trigger("change"),b=null}},hideDropDown:function(){a("#afModalMask").hide(),a("#afSelectBoxfix").html("")},createHtml:function(){var b=this;document.getElementById("afSelectBoxfix")||a(document).ready(function(){a(document).on("click",".afFakeSelect",function(){this.linker.disabled||(b.currLinker=this,"multiple"===this.linker.getAttribute("multiple")?a("#afSelectClose").show():a("#afSelectClose").hide(),b.initDropDown(this.linker))});var c=a.create("div",{id:"afSelectBoxContainer"}),d=a.create("div",{id:"afSelectBoxfix"}),e=a.create("div",{id:"afSelectWrapper"});e.css("position","relative"),e.append(d);var f=a.create("div",{id:"afSelectClose",html:"<a id='afSelectDone'>Done</a> <a id='afSelectCancel'>Cancel</a>"}),g=a.create("div",{id:"afModalMask"}),h=a("#afui");c.prepend(f).append(e),g.append(c),h.length>0?h.append(g):document.body.appendChild(g.get(0)),b.scroller=a.query("#afSelectBoxfix").scroller({scroller:!1,verticalScroll:!0,vScrollCSS:"afselectscrollBarV",hasParent:!0}),a("#afModalMask").on("click",function(c){var d=a(c.target);0===d.closest("#afSelectBoxContainer").length&&b.hideDropDown()}),a("#afSelectBoxfix").on("click","li",function(c){var d=a(c.target);b.setDropDownValue(b.currLinker.linker,d.data("ind"))}),a("#afSelectBoxContainer").on("click","a",function(c){if("afSelectCancel"===c.target.id)return b.hideDropDown();var d=a(b.currLinker.linker);return d.find("option").prop("selected",!1),a("#afSelectBoxfix li").each(function(){var e=a(this);if(e.hasClass("selected")){var f=parseInt(e.data("ind"),10);d.find("option:nth-child("+(f+1)+")").prop("selected",!0),b.currLinker.innerHTML=e.html()}}),b.hideDropDown(),c.stopPropagation(),c.preventDefault(),!1})})}},HTMLElement.prototype.watch||(HTMLElement.prototype.watch=function(a,b){var c=this[a],d=c,e=function(){return d},f=function(e){return c=d,d=b.call(this,a,c,e)};delete this[a]&&(HTMLElement.defineProperty?HTMLElement.defineProperty(this,a,{get:e,set:f,enumerable:!1,configurable:!0}):HTMLElement.prototype.__defineGetter__&&HTMLElement.prototype.__defineSetter__&&(HTMLElement.prototype.__defineGetter__.call(this,a,e),HTMLElement.prototype.__defineSetter__.call(this,a,f)))}),HTMLElement.prototype.unwatch||(HTMLElement.prototype.unwatch=function(a){var b=this[a];delete this[a],this[a]=b})}(af);